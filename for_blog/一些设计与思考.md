# 一些设计与思考

## 共同点

在确定了题目（博客系统）之后，我浏览了很多网上的博客论坛，已经形成平台的，比如csdn，比如博客园等等，个人博客也看了很多，发现以下共通点：

**首先， 既然是以网站形式展现，那首页就是必须的，至于首页的内容，排除广告部分，博客园采用的是推荐+最新，即官方推荐的帖子属于置顶，在最上层，而最新的文章一般排列在置顶文章之后；csdn的话，现如今其已不仅仅是一个博客论坛，还涉及许多服务，因此在考虑的时候仅需考虑博客问题即可，其博客系统可根据不同的选择进行排序，比如推荐榜、资讯榜、热榜等，而个人博客，首页的文章基本是按时间进行排序。**

**除了首页之外，还有一个模块是分类模块，即按照文章所属的类别进行分类，展现形式略有不同，有的是直接省略了分类栏而将具体标签直接呈现，有的则是有专一的分类按钮展开后进行分类选择。**

**还有的就是关于我（登录功能），一般处于界面的右上角，用于展示个人中心管理以及登录登出注册功能。**

## 功能设计

此处的功能设计只考虑此系统应所涉及的功能，具体如何实现暂不考虑。

**首页部分实际上是一个文章列表查询功能，需查询出每篇文章的简略信息，需要的信息是：标题、简介（可以直接选取文章开头部分）、作者、创作时间、点赞数、评论数以及观看次数。**

**分类模块实则就是按照标签对文章进行查询，查询出的内容形式其实与首页的文章展现形式是一样的，都是文章的简略信息。**

**个人中心功能，主要涉及登录、登出以及注册，这里考虑的是，是否需要将注册功能与发送验证码功能想结合，即注册是否需要通过手机号进行注册，如果涉及手机号注册那就需要考虑找回密码功能。**

**搜索功能则是老师比较看重的，即博客需实现对文章的搜索功能，我最初的想法是结合分词器在数据库中进行模糊搜索即可，但此方法查询效率较低，而且也不满足老师的要求，因此需对此方法进行改进，比如增加人工智能算法之类的。**

**文章详情页还需要评论功能，评论主要需要的内容有，谁评论，给谁评论，评论的内容以及时间。**

## 相应数据及其数据库中的对应类型

#### 文章

**标题、作者、简介、创作时间、点赞数、评论数、观看数、所属标签、所属分类、文章主体、是否置顶**

标题，毫无疑问是**varchar**类型；作者处可以考虑存入作者id而不是其对应的昵称，防止用户更改昵称进而引起一系列变化，而id的设置有两种选择，一种是**bigint**，一种是**varchar**；简介的来源可有两种，一是用户在创作博客时自行填入，若是用户未填入数据时，可选择将文章主体部分的前20~30个字填入其中作为文章简介，因此其也为**varchar**类型；创作时间为**datetime**类型，用于精确到时分秒；点赞、观看以及评论数都是**int**型；所属标签和所属分类，本人的想法是标签可提供自定义功能，即用户可在创作文章时自行选择标签，分类则无法自定义，需由创作者从设定好的分类列表中选取类别进行添加，暂时的考虑是：一篇文章可对应多个标签，一个标签也可供多篇文章使用，属于多对多关系，因此在关系映射中单独建一个映射表，而分类，由于一篇文章仅唯一对应一个类别，因此此处只需存储该类别对应的id即可，**varchar** or **bigint**，文章主体可单独拿出一个文章表，因此此处只需存入文章表的id即可，**varchar** or **bigint**；是否置顶使用**bit**即可。

#### 用户

**用户id、用户名、密码、头像、昵称、邮箱、性别、电话、是否是管理员、注册时间**

用户id，**varchar** or **bigint**；用户名有两种考虑，如果是使用手机号注册，那毫无疑问就是手机号为**bigint**，若未植入验证码注册功能，则用户名可由申请人自行定义，因此就为**varchar**；密码选择**varchar**，但在存入数据库时需进行加密，即存入数据库中的密码应为加密后的密码；头像存储的是头像对应文件所在的路径，为**varchar**类型；昵称则是用户发表博客或者创建评论时使用的，为**varchar**类型；可进行邮箱与电话绑定，均为**varchar**类型；性别，0为女1为男因此只需**bit**类型即可；管理员可登录后台进行用户管理，0表示不是管理员，1表示是管理员，因此使用**bit**类型；注册时间为**datetime**。

#### 评论

**评论id、评论内容、评论者id、被评论者id、评论层级、评论时间、点赞数**

评论id，**varchar** or **bigint**；评论内容用于存储评论的主体，**varchar**类型；评论者以及被评论者id，**varchar** or **bigint**，评论者id用于标识是谁的评论，被评论者id用于标识给谁评论；评论层级使用**bit**即可，0表示此条评论评论的是文章内容，1标识此条是对评论的评论；评论时间，**datetime**；点赞数**int**。

#### 分类

**类别id（varchar or bigint）、类别名称（varchar）、类别描述（varchar）。**

#### 标签

**标签id（varchar or bigint）、标签内容（varchar）。**

#### 文章主体

文章部分，由于需要集成markdown编辑器，因此需要保存对应的html文档。

**主体id（varchar or bigint）、主体内容（text）、主体对应的html文档（text）。**

#### 文章-标签

**对应id（varchar or bigint）、文章id（varchar or bigint）、标签id（varchar or bigint）。**

## 之后忽然想到的

### 查询文章主体内容（文章详情页）-->记得增加观看数

**get**

### 点赞功能（对文章点赞以及对评论点赞）

点赞这里，思考了很久之后决定新建两个表，文章点赞表中有四条数据，id（主键）、userId（用户id）、articleId（文章id）、ifLike（是否点赞）类似评论点赞表也有四条数据id（主键）、userId（用户id）、commentId（评论id）、ifLike（是否点赞）

**get**

### 同理还有取消点赞功能

取消点赞有两种实现方式，更新数据like_comment表或删除对应字段，我选择的是更新，即置if_like为0。

**get**

### 评论功能

这里也是有两个东西，新增评论和删除评论

**这里要注意的是评论操作分两步，对评论表操作以及对文章表操作（文章评论总数）**

**get**

#### TODO

对操作加事务，文章表和评论表中的操作只要有一个没完成，进行事务回滚